<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Property Details - Nirvana Estates</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  body { background-color: #f9fafb; }

  /* Carousel / Gallery */
  .carousel { display: flex; overflow-x: auto; scroll-snap-type: x mandatory; gap: 1rem; padding: 0.5rem 0; -webkit-overflow-scrolling: touch; }
  .carousel::-webkit-scrollbar { display: none; }
  .carousel-item { flex: 0 0 auto; scroll-snap-align: start; border-radius: 0.75rem; overflow: hidden; background: #000; position: relative; width: 250px; height: 450px; display: flex; align-items: center; justify-content: center; }
  .carousel-item img, .carousel-item iframe, .carousel-item video { width: 100%; height: 100%; object-fit: cover; border-radius: 0.75rem; }

  /* Info grid */
  .info-card { background: #fff; border-radius: 1rem; padding: 1rem; box-shadow: 0 6px 20px rgba(0,0,0,0.08); }
  .info-grid { display: grid; grid-template-columns: repeat(2,1fr); gap: 1rem; }
  @media(min-width:1024px){ .info-grid { grid-template-columns: repeat(3,1fr); } }
  .info-grid div span { font-weight: 600; }

  /* CTA Buttons */
  .cta-btn { padding: 0.5rem 1rem; border-radius: 0.5rem; font-weight: 600; transition: all 0.2s; }
  .cta-call { background-color: #0f2b3d; color: #fff; }
  .cta-call:hover { background-color: #15425c; }
  .cta-wa { background-color: #22c55e; color: #fff; }
  .cta-wa:hover { background-color: #16a34a; }

  .floating-call { position: fixed; bottom: 1rem; right: 1rem; background-color: #0f2b3d; color: #fff; padding: 0.75rem 1rem; border-radius: 9999px; font-weight: 600; box-shadow: 0 4px 15px rgba(0,0,0,.2); z-index: 50; transition: background 0.2s; }
  .floating-call:hover { background-color: #15425c; }

  /* Text & Typography */
  .prose { max-width: 100%; line-height: 1.6; }

  @media(min-width:1024px){
  .carousel{
    overflow-x: hidden;
  }
}

</style>
</head>
<body class="text-gray-800">

<!-- Header -->
<div id="header-placeholder"></div>
<script>
  fetch('header_main.html')
    .then(response => response.text())
    .then(data => {
      document.getElementById('header-placeholder').innerHTML = data;

      const menuToggle = document.getElementById('menu-toggle');
      const mobileMenu = document.getElementById('mobile-menu');
      const line1 = document.getElementById('line1');
      const line2 = document.getElementById('line2');
      const header = document.getElementById('header');
      const headerContent = document.getElementById('header-content');
      const logo = document.getElementById('logo');
      const nameImg = document.getElementById('name-img');

      // Apply slide animation classes
      mobileMenu.style.transition = "max-height 0.35s ease, opacity 0.35s ease";
      mobileMenu.style.overflow = "hidden";
      mobileMenu.style.maxHeight = "0";
      mobileMenu.style.opacity = "0";

      const toggleMenu = () => {
        const isOpening = mobileMenu.style.maxHeight === "0px" || mobileMenu.style.maxHeight === "0";
        
        if (isOpening) {
          mobileMenu.classList.remove('hidden');
          mobileMenu.style.maxHeight = mobileMenu.scrollHeight + "px";
          mobileMenu.style.opacity = "1";
          line1.style.transform = 'rotate(45deg) translate(4px, 4px)';
          line2.style.transform = 'rotate(-45deg) translate(4px, -4px)';
        } else {
          mobileMenu.style.maxHeight = "0";
          mobileMenu.style.opacity = "0";
          setTimeout(() => mobileMenu.classList.add('hidden'), 350);
          line1.style.transform = 'rotate(0deg) translate(0, 0)';
          line2.style.transform = 'rotate(0deg) translate(0, 0)';
        }
      };

      menuToggle.addEventListener('click', toggleMenu);

      // Close on menu link click
      mobileMenu.querySelectorAll('a').forEach(link => {
        link.addEventListener('click', () => {
          mobileMenu.style.maxHeight = "0";
          mobileMenu.style.opacity = "0";
          setTimeout(() => mobileMenu.classList.add('hidden'), 350);
          line1.style.transform = 'rotate(0deg) translate(0, 0)';
          line2.style.transform = 'rotate(0deg) translate(0, 0)';
        });
      });

      // Close on click outside
      document.addEventListener('click', (e) => {
        const isClickInside = mobileMenu.contains(e.target) || menuToggle.contains(e.target);
        const isOpen = mobileMenu.style.maxHeight !== "0" && !mobileMenu.classList.contains('hidden');

        if (!isClickInside && isOpen) {
          mobileMenu.style.maxHeight = "0";
          mobileMenu.style.opacity = "0";
          setTimeout(() => mobileMenu.classList.add('hidden'), 350);
          line1.style.transform = 'rotate(0deg) translate(0, 0)';
          line2.style.transform = 'rotate(0deg) translate(0, 0)';
        }
      });

      // Shrink header on scroll
      window.addEventListener('scroll', () => {
        if (window.scrollY > 50) {
          header.classList.add('shadow-lg');
          headerContent.classList.add('h-16', 'md:h-20');
          logo.classList.add('h-10', 'md:h-14');
          logo.classList.remove('h-12', 'md:h-16');
          nameImg.classList.add('h-5', 'md:h-6');
          nameImg.classList.remove('h-6', 'md:h-8');
        } else {
          header.classList.remove('shadow-lg');
          headerContent.classList.remove('h-16', 'md:h-20');
          logo.classList.remove('h-10', 'md:h-14');
          logo.classList.add('h-12', 'md:h-16');
          nameImg.classList.remove('h-5', 'md:h-6');
          nameImg.classList.add('h-6', 'md:h-8');
        }
      });
    })
    .catch(err => console.error('Failed to load header:', err));
</script>

<main class="max-w-7xl mx-auto px-4 py-6 space-y-6">

  <!-- Gallery -->
  <section id="gallery"></section>

  <!-- Title & Price -->
  <section class="space-y-3">
    <div class="flex flex-col lg:flex-row lg:justify-between lg:items-end gap-2">
      <h2 id="property-title" class="text-2xl md:text-3xl font-bold">Property Title</h2>
      <span id="property-price" class="text-[#0f2b3d] font-extrabold text-xl md:text-2xl"></span>
    </div>
  </section>

  <!-- Info Grid -->
  <section class="info-card">
    <div class="info-grid" id="info-grid"></div>
  </section>

  <!-- Description -->
  <section class="prose prose-sm max-w-none text-gray-800">
    <h3 class="text-lg font-semibold mb-2">Description</h3>
    <div id="property-desc"></div>
  </section>

  <!-- CTA Buttons -->
  <section class="flex flex-wrap gap-4">
    <a id="call-btn" class="cta-btn cta-call" href="#">Call Now</a>
    <a id="wa-btn" class="cta-btn cta-wa" href="#" target="_blank">WhatsApp</a>
  </section>

</main>

<!-- Floating Call Button -->
<a href="tel:+917039199717" class="floating-call">ðŸ“ž Call Now</a>



<script>
const INR = new Intl.NumberFormat('en-IN', { style: 'currency', currency: 'INR' });

// Create gallery slide
function createSlide(src,type){
  const wrap = document.createElement('div');
  wrap.className = 'carousel-item';
  if(type==='image'){ const img = new Image(); img.src=src; wrap.appendChild(img); }
  else{
    if(src.includes('youtube.com') || src.includes('youtu.be')){
      let videoId='';
      if(src.includes('shorts/')) videoId=src.split('shorts/')[1].split('?')[0];
      else if(src.includes('youtu.be/')) videoId=src.split('youtu.be/')[1].split('?')[0];
      else if(src.includes('watch?v=')) videoId=src.split('watch?v=')[1].split('&')[0];
      const iframe = document.createElement('iframe');
      // iframe.src = `https://www.youtube.com/embed/${videoId}?rel=0&autoplay=0`;
      iframe.src = `https://www.youtube-nocookie.com/embed/${videoId}?rel=0`;
      iframe.allow = 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture';
      iframe.allowFullscreen = true;
      wrap.appendChild(iframe);
    } else {
      const vid = document.createElement('video'); vid.src=src; vid.preload='metadata'; vid.muted=true; vid.playsInline=true; vid.controls=true;
      wrap.appendChild(vid);
    }
  }
  return wrap;
}

// Load property details
async function loadDetails() {
  const params = new URLSearchParams(location.search);
  const id = params.get('id');

  if (!id) {
    document.getElementById('gallery').innerHTML =
      '<p class="text-red-600">Invalid property ID.</p>';
    return;
  }

  try {
    const res = await fetch('https://nirvana-estates-backend.onrender.com/api/properties');
    if (!res.ok) throw new Error('API failed');

    const all = await res.json();
    const p = all.find(x => String(x._id) === String(id));

    if (!p) {
      document.getElementById('gallery').innerHTML =
        '<p class="text-red-600">Property not found.</p>';
      return;
    }

    /* ---------- Gallery ---------- */
    const gallery = document.getElementById('gallery');
    gallery.innerHTML = '';

    const track = document.createElement('div');
    track.className = 'carousel';

    const media = [
      ...(Array.isArray(p.images) ? p.images.map(s => ({ src: s, type: 'image' })) : []),
      ...(Array.isArray(p.videos) ? p.videos.map(s => ({ src: s, type: 'video' })) : [])
    ];

    if (media.length) {
      media.forEach(m => track.appendChild(createSlide(m.src, m.type)));
    } else {
      const ph = document.createElement('div');
      ph.className =
        'w-full h-64 flex items-center justify-center bg-gray-200 text-gray-500 rounded';
      ph.textContent = 'No media available';
      track.appendChild(ph);
    }

    gallery.appendChild(track);

    /* ---------- Title ---------- */
    document.getElementById('property-title').textContent =
      p.title || 'Property';

    /* ---------- Price (only if valid) ---------- */
    const priceEl = document.getElementById('property-price');
    if (p.price && Number(p.price) > 0) {
      priceEl.textContent = INR.format(p.price);
      priceEl.classList.remove('hidden');
    } else {
      priceEl.textContent = '';
      priceEl.classList.add('hidden');
    }

    /* ---------- Info Grid ---------- */
    const infoGrid = document.getElementById('info-grid');
    infoGrid.innerHTML = '';

    const cell = (label, value) => {
      const d = document.createElement('div');
      d.innerHTML = `<span>${label}:</span> ${value}`;
      return d;
    };

    if (p.bedrooms && Number(p.bedrooms) > 0)
      infoGrid.appendChild(cell('Bedrooms', p.bedrooms));

    if (p.bathrooms && Number(p.bathrooms) > 0)
      infoGrid.appendChild(cell('Bathrooms', p.bathrooms));

    if (p.carpetArea)
      infoGrid.appendChild(cell('Carpet Area', `${p.carpetArea} sq ft`));

    if (p.builtupArea)
      infoGrid.appendChild(cell('Built-up Area', `${p.builtupArea} sq ft`));

    if (p.location)
      infoGrid.appendChild(cell('Location', p.location));

    if (p.category)
      infoGrid.appendChild(cell('Category', p.category));

    /* ---------- Description ---------- */
    const descEl = document.getElementById('property-desc');

if (p.description) {
  descEl.innerHTML = renderDescription(p.description);
} else {
  descEl.innerHTML = '<p class="text-sm text-gray-500">No description provided.</p>';
}


    /* ---------- CTA ---------- */
    document.getElementById('call-btn').href = 'tel:+917039199717';
    document.getElementById('wa-btn').href =
      'https://wa.me/917039199717?text=' +
      encodeURIComponent(`I am interested in property: ${p.title || p._id}`);

  } catch (e) {
    console.error(e);
    document.getElementById('gallery').innerHTML =
      '<p class="text-red-600">Failed to load property details.</p>';
  }
}

function renderDescription(desc) {
  if (!desc) return '';

  const lines = desc.split(/\r?\n/);
  let html = '';
  let inList = false;

  lines.forEach(line => {
    const trimmed = line.trim();

    // Empty line â†’ close bullet list
    if (trimmed === '') {
      if (inList) {
        html += '</ul>';
        inList = false;
      }
      return;
    }

    // Detect bullets: -, *, â€¢
    const isBullet = /^[-*â€¢]\s+/.test(trimmed);

    if (isBullet) {
      if (!inList) {
        html += '<ul class="list-disc pl-5 text-sm text-gray-700 space-y-1">';
        inList = true;
      }
      html += `<li>${trimmed.replace(/^[-*â€¢]\s+/, '')}</li>`;
    } else {
      if (inList) {
        html += '</ul>';
        inList = false;
      }
      html += `<p class="text-sm text-gray-700 mb-2">${trimmed}</p>`;
    }
  });

  if (inList) html += '</ul>';

  return html;
}

loadDetails();
</script>

<!-- Footer -->
  <!-- Copyright Bar -->
  <div class="bg-[#0f2b3d] text-gray-300 text-center text-sm py-4">
    Â© <span id="year"></span> Nirvana Estates. All rights reserved.
  </div>

</footer>

<script>
  document.getElementById('year').textContent = new Date().getFullYear();
</script>
</body>
</html>