<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Buyers - Nirvana Estates</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
body { background-color: #f9fafb; }
.card { transition: transform .3s, box-shadow .3s; }
.card:hover { transform: translateY(-5px); box-shadow: 0 15px 30px rgba(0,0,0,.15); }
.carousel { display: flex; overflow-x: auto; scroll-snap-type: x mandatory; gap: 0.75rem; padding: 0.5rem 0; -webkit-overflow-scrolling: touch; }
.carousel::-webkit-scrollbar { display: none; }
.carousel-item { flex: 0 0 100%; scroll-snap-align: start; display: flex; justify-content: center; align-items: center; }
.short-media { width: auto; max-width: 280px; height: 500px; object-fit: cover; border-radius: 0.75rem; box-shadow: 0 6px 18px rgba(0,0,0,0.1); transition: transform .3s; }
.short-media:hover { transform: scale(1.02); }
@media(min-width:1024px){ #grid { display: grid; grid-template-columns: repeat(3,1fr); gap: 1.5rem; } .short-media { max-width: 100%; height: 350px; } .card-body { display: flex; flex-direction: column; gap:0.5rem; } }
.carousel{
  cursor: grab;
}
.carousel:active{
  cursor: grabbing;
}
.carousel{
  scroll-behavior: smooth;
}

</style>
</head>
<body class="text-gray-800">

<div id="header-placeholder"></div>
<script>
  fetch('header_main.html')
    .then(response => response.text())
    .then(data => {
      document.getElementById('header-placeholder').innerHTML = data;

      const menuToggle = document.getElementById('menu-toggle');
      const mobileMenu = document.getElementById('mobile-menu');
      const line1 = document.getElementById('line1');
      const line2 = document.getElementById('line2');
      const header = document.getElementById('header');
      const headerContent = document.getElementById('header-content');
      const logo = document.getElementById('logo');
      const nameImg = document.getElementById('name-img');

      // Apply slide animation classes
      mobileMenu.style.transition = "max-height 0.35s ease, opacity 0.35s ease";
      mobileMenu.style.overflow = "hidden";
      mobileMenu.style.maxHeight = "0";
      mobileMenu.style.opacity = "0";

      const toggleMenu = () => {
        const isOpening = mobileMenu.style.maxHeight === "0px" || mobileMenu.style.maxHeight === "0";
        
        if (isOpening) {
          mobileMenu.classList.remove('hidden');
          mobileMenu.style.maxHeight = mobileMenu.scrollHeight + "px";
          mobileMenu.style.opacity = "1";
          line1.style.transform = 'rotate(45deg) translate(4px, 4px)';
          line2.style.transform = 'rotate(-45deg) translate(4px, -4px)';
        } else {
          mobileMenu.style.maxHeight = "0";
          mobileMenu.style.opacity = "0";
          setTimeout(() => mobileMenu.classList.add('hidden'), 350);
          line1.style.transform = 'rotate(0deg) translate(0, 0)';
          line2.style.transform = 'rotate(0deg) translate(0, 0)';
        }
      };

      menuToggle.addEventListener('click', toggleMenu);

      // Close on menu link click
      mobileMenu.querySelectorAll('a').forEach(link => {
        link.addEventListener('click', () => {
          mobileMenu.style.maxHeight = "0";
          mobileMenu.style.opacity = "0";
          setTimeout(() => mobileMenu.classList.add('hidden'), 350);
          line1.style.transform = 'rotate(0deg) translate(0, 0)';
          line2.style.transform = 'rotate(0deg) translate(0, 0)';
        });
      });

      // Close on click outside
      document.addEventListener('click', (e) => {
        const isClickInside = mobileMenu.contains(e.target) || menuToggle.contains(e.target);
        const isOpen = mobileMenu.style.maxHeight !== "0" && !mobileMenu.classList.contains('hidden');

        if (!isClickInside && isOpen) {
          mobileMenu.style.maxHeight = "0";
          mobileMenu.style.opacity = "0";
          setTimeout(() => mobileMenu.classList.add('hidden'), 350);
          line1.style.transform = 'rotate(0deg) translate(0, 0)';
          line2.style.transform = 'rotate(0deg) translate(0, 0)';
        }
      });

      // Shrink header on scroll
      window.addEventListener('scroll', () => {
        if (window.scrollY > 50) {
          header.classList.add('shadow-lg');
          headerContent.classList.add('h-16', 'md:h-20');
          logo.classList.add('h-10', 'md:h-14');
          logo.classList.remove('h-12', 'md:h-16');
          nameImg.classList.add('h-5', 'md:h-6');
          nameImg.classList.remove('h-6', 'md:h-8');
        } else {
          header.classList.remove('shadow-lg');
          headerContent.classList.remove('h-16', 'md:h-20');
          logo.classList.remove('h-10', 'md:h-14');
          logo.classList.add('h-12', 'md:h-16');
          nameImg.classList.remove('h-5', 'md:h-6');
          nameImg.classList.add('h-6', 'md:h-8');
        }
      });
    })
    .catch(err => console.error('Failed to load header:', err));
</script>

<main class="max-w-7xl mx-auto px-4 py-6">
  <h2 class="text-2xl md:text-3xl font-bold text-gray-900 mb-6">Properties for Buyers</h2>
  <div id="grid" class="grid grid-cols-1 sm:grid-cols-1 lg:grid-cols-3 gap-6"></div>
</main>

<a href="tel:+917039199717" class="fixed bottom-4 right-4 z-50 bg-[#0f2b3d] text-white px-4 py-3 rounded-full shadow-lg font-semibold">
  ðŸ“ž Call Now
</a>

<script>
const INR = n => Number(n).toLocaleString('en-IN', { style: 'currency', currency: 'INR', maximumFractionDigits: 0 });

const BACKEND = "https://nirvana-estates-backend.onrender.com";

function fixMediaUrl(src){
  if(!src) return '';
  if(src.startsWith('http')) return src;
  return `${BACKEND}/${src.replace(/^\/+/, '')}`;
}


function createMediaSlide(src,type){
  const div=document.createElement('div');
  div.className='carousel-item';
  if(type==='image'){
    const img=document.createElement('img');
    img.src = fixMediaUrl(src); img.alt='Property Image'; img.loading='lazy';
    img.className='short-media';
    div.appendChild(img);
  } else {
    let videoId='';
    if(src.includes('shorts/')) videoId=src.split('shorts/')[1].split('?')[0];
    else if(src.includes('youtu.be/')) videoId=src.split('youtu.be/')[1].split('?')[0];
    else if(src.includes('watch?v=')) videoId=src.split('watch?v=')[1].split('&')[0];
    const iframe=document.createElement('iframe');
    // iframe.src=`https://www.youtube.com/embed/${videoId}?rel=0&autoplay=0`;
    iframe.src = `https://www.youtube-nocookie.com/embed/${videoId}?rel=0`;
    iframe.allow='accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture';
    iframe.allowFullscreen=true;
    iframe.className='short-media';
    div.appendChild(iframe);
  }
  return div;
}

function propertyCard(p){
  const card=document.createElement('article');
  card.className='card bg-white rounded-xl overflow-hidden shadow hover:shadow-lg transition-shadow flex flex-col';
  const carouselContainer=document.createElement('div'); carouselContainer.className='carousel-container';
  const carousel=document.createElement('div'); carousel.className='carousel';
  const allMedia=[...(p.images||[]).map(s=>({src:s,type:'image'})), ...(p.videos||[]).map(s=>({src:s,type:'video'}))];
  if(allMedia.length===0){ const ph=document.createElement('div'); ph.className='w-full h-48 flex items-center justify-center text-gray-400 bg-gray-200 rounded-xl'; ph.textContent='No media'; carousel.appendChild(ph); }
  else allMedia.forEach(m=>carousel.appendChild(createMediaSlide(m.src,m.type)));
  carouselContainer.appendChild(carousel); card.appendChild(carouselContainer);

  const body=document.createElement('div'); body.className='card-body p-4 flex flex-col gap-3';
  const title=document.createElement('h3'); title.className='text-lg font-semibold text-gray-900'; title.textContent=p.title||'Property';
  const price=document.createElement('span'); price.className='text-[#0f2b3d] font-bold'; price.textContent=INR(p.price);
  const sub=document.createElement('p'); sub.className='text-gray-600 text-sm';
  let builtupText = p.builtupArea ? ` | Built-up: ${p.builtupArea} sq ft` : '';
  sub.textContent=`${p.bedrooms} Bed | ${p.bathrooms} Bath | Carpet: ${p.carpetArea} sq ft${builtupText} | ${p.location}`;
  
  const ctaRow=document.createElement('div'); ctaRow.className='mt-2 flex flex-wrap gap-2';
  const details=document.createElement('a'); details.href=`property-details.html?id=${p._id}`;details.target='_blank'; details.className='px-3 py-2 rounded bg-[#0f2b3d] text-white text-sm font-semibold hover:bg-[#15425c]'; details.textContent='View Details';
  const call=document.createElement('a'); call.href='tel:+917039199717'; call.className='px-3 py-2 rounded bg-green-600 text-white text-sm font-semibold hover:bg-green-700'; call.textContent='Call';
  ctaRow.append(details,call);

  body.append(title,price,sub,ctaRow); card.appendChild(body);
  return card;
}

async function load(){
  try{
    const BACKEND = "https://nirvana-estates-backend.onrender.com";
    const res = await fetch(`${BACKEND}/api/properties`);
    const list = await res.json();
    const grid = document.getElementById('grid'); grid.innerHTML='';
    list.filter(p=> (p.category||'').toLowerCase()==='buyers').forEach(p=> grid.appendChild(propertyCard(p)));
  } catch(e){ console.error(e); document.getElementById('grid').innerHTML='<div class="text-red-600">Failed to load properties.</div>'; }
}
load();
</script>

<!-- Footer -->
  <!-- Copyright Bar -->
  <div class="bg-[#0f2b3d] text-gray-300 text-center text-sm py-4">
    Â© <span id="year"></span> Nirvana Estates. All rights reserved.
  </div>

</footer>

<script>
  document.getElementById('year').textContent = new Date().getFullYear();
</script>
</body>
</html>
